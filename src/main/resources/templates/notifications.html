<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Bildirimlerim</title>
    <link rel="stylesheet" href="/css/base.css" />
    <link rel="stylesheet" href="/css/dashboard.css" />
    <style>
        .notif { padding: 12px; border-bottom: 1px solid #eee; }
        .notif.unread { background: #fbfbfb; }
        .title { font-weight: 600; }
        .meta { color: #666; font-size: 12px; }
    </style>
    <script src="/js/auth.js" defer></script>
</head>
<body>
<div class="container">
    <h2>Bildirimlerim</h2>
    <div id="notifLoading" class="muted" style="display:none;">YÃ¼kleniyor...</div>
    <div id="notifEmpty" class="muted" style="display:none;">Bildirim yok</div>
    <div id="notifList"></div>
</div>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const session = Auth.ensureAuthenticated();
  if (!session) return;
  await loadNotifications();
});

async function loadNotifications() {
  const loading = document.getElementById('notifLoading');
  const empty = document.getElementById('notifEmpty');
  const list = document.getElementById('notifList');
  loading.style.display = 'block';
  empty.style.display = 'none';
  list.innerHTML = '';
  try {
    const res = await Auth.authFetch('/api/notifications');
    loading.style.display = 'none';
    if (!res.ok) { empty.style.display = 'block'; return; }
    const items = await res.json();
    if (!items || items.length === 0) { empty.style.display = 'block'; return; }
    items.forEach(n => {
      const div = document.createElement('div');
      div.className = 'notif' + (!n.readFlag ? ' unread' : '');
      div.innerHTML = `<div class='title'>${escapeHtml(n.title || '')}</div>
                       <div>${escapeHtml(n.message || '')}</div>
                       <div class='meta'>${(n.createdAt || '').toString().substring(0,16).replace('T',' ')}</div>`;
      list.appendChild(div);
    });
  } catch (e) {
    loading.style.display = 'none';
    empty.style.display = 'block';
  }
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}
</script>
</body>
</html>


