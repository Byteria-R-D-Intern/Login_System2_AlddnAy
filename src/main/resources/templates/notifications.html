<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Bildirimlerim</title>
    <link rel="stylesheet" href="/css/base.css" />
    <link rel="stylesheet" href="/css/dashboard.css" />
    <style>
        .page-container { max-width: 960px; margin: 24px auto; padding: 0 12px; }
        .card { background: #fff; border: 1px solid #e8e8e8; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        .card-title { font-size: 18px; font-weight: 700; margin: 0 0 12px; }
        .notif-list { display: flex; flex-direction: column; gap: 12px; }
        .notif { padding: 12px; border: 1px solid #eee; border-radius: 10px; background: #fafafa; }
        .notif.unread { background: #fbfbff; border-color: #dfe3ff; }
        .notif .title { font-weight: 600; margin: 0 0 6px; }
        .notif .meta { color: #666; font-size: 12px; margin-top: 6px; }
    </style>
    <script src="/js/auth.js" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const session = Auth.ensureAuthenticated();
      if (!session) return;
      await loadNotifications();
    });

    async function loadNotifications() {
      const loading = document.getElementById('notifLoading');
      const list = document.getElementById('notifList');
      loading.style.display = 'block';
      list.innerHTML = '';
      try {
        const token = localStorage.getItem('authToken');
        const res = await fetch('/api/notifications', {
          headers: { Authorization: 'Bearer ' + token }
        });
        loading.style.display = 'none';
        if (!res.ok) { return; }
        const items = await res.json();
        const title = document.getElementById('notifPageTitle');
        if (title) title.textContent = `Bildirimlerim (${items?.length ?? 0})`;
        (items || []).forEach(n => {
          const div = document.createElement('div');
          div.className = 'notif' + (!n.readFlag ? ' unread' : '');
          div.innerHTML = `<div class='title'>${escapeHtml(n.title || '')}</div>
                           <div>${escapeHtml(n.message || '')}</div>
                           <div class='meta'>${(n.createdAt || '').toString().substring(0,16).replace('T',' ')}</div>`;
          list.appendChild(div);
        });
      } catch (e) {
        loading.style.display = 'none';
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    </script>
</head>
<body>
  <div class="page-container">
    <div class="card">
      <h2 id="notifPageTitle" class="card-title">Bildirimlerim</h2>
      <div id="notifLoading" class="muted" style="display:none;">YÃ¼kleniyor...</div>
      <div id="notifList" class="notif-list"></div>
    </div>
  </div>
</body>
</html>


